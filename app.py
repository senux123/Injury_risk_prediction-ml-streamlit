# -*- coding: utf-8 -*-
"""app

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1DoeM5DdkVfYQy7dhCkmOWcW1aCiILNCK
"""

## IMPORTS ##

import streamlit as st
import pandas as pd
import joblib

st.set_page_config(page_title="Injury Risk Prediction (ML Baseline)", layout="centered")

st.title("Sports Injury Risk Prediction (ML Baseline)")
st.write("Enter athlete/training parameters to estimate injury risk (Low/High).")

@st.cache_resource
def load_artifacts():
    model = joblib.load("artifacts/best_injury_risk_model.pkl")
    scaler = joblib.load("artifacts/scaler.pkl")
    feature_columns = joblib.load("artifacts/feature_columns.pkl")
    return model, scaler, feature_columns

model, scaler, feature_columns = load_artifacts()

st.subheader("Athlete Input")


inputs = {}

col1, col2 = st.columns(2)

with col1:
    inputs["Age"] = st.number_input("Age", min_value=10, max_value=80, value=24)
    inputs["Gender"] = st.selectbox("Gender", options=[0, 1], format_func=lambda x: "Female" if x == 0 else "Male")
    inputs["Height_cm"] = st.number_input("Height (cm)", min_value=120.0, max_value=220.0, value=178.0)
    inputs["Weight_kg"] = st.number_input("Weight (kg)", min_value=30.0, max_value=200.0, value=72.0)
    inputs["Sleep_Hours"] = st.number_input("Sleep Hours", min_value=0.0, max_value=12.0, value=7.5)

with col2:
    inputs["Training_Frequency"] = st.number_input("Training Frequency (sessions/week)", min_value=0.0, max_value=14.0, value=4.0)
    inputs["Training_Duration"] = st.number_input("Training Duration (minutes)", min_value=0.0, max_value=300.0, value=90.0)
    inputs["Warmup_Time"] = st.number_input("Warmup Time (minutes)", min_value=0.0, max_value=60.0, value=10.0)
    inputs["Flexibility_Score"] = st.number_input("Flexibility Score", min_value=0.0, max_value=100.0, value=65.0)
    inputs["Training_Intensity"] = st.number_input("Training Intensity (1–10)", min_value=1.0, max_value=10.0, value=7.0)

# Remaining fields
inputs["Muscle_Asymmetry"] = st.number_input("Muscle Asymmetry (%)", min_value=0.0, max_value=50.0, value=5.0)
inputs["Recovery_Time"] = st.number_input("Recovery Time", min_value=0.0, max_value=200.0, value=48.0)
inputs["Injury_History"] = st.number_input("Injury History (count)", min_value=0.0, max_value=10.0, value=1.0)
inputs["Stress_Level"] = st.number_input("Stress Level (1–10)", min_value=1.0, max_value=10.0, value=6.0)

# --- Predict ---
st.subheader("Prediction")

if st.button("Predict Injury Risk"):
    input_df = pd.DataFrame([inputs])

    # Ensure correct order
    input_df = input_df[feature_columns]

    # Scale
    input_scaled = scaler.transform(input_df)

    # Predict
    pred = int(model.predict(input_scaled)[0])
    prob = float(model.predict_proba(input_scaled)[0, 1])

    label = "High risk" if pred == 1 else "Low risk"

    st.success(f"Predicted risk: {label}")
    st.write(f"Probability of high risk: **{prob:.3f}**")


    st.caption('note: this is model is trained on a tabular clean dataset and is clearly intended as a learning benchmark')
